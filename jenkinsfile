pipeline {

agent any

''' This way cannot be good for credentials.  For other non sensitive data we can use this
environment {
  MONGO_URI = "mongodb+srv://supercluster.d83jj.mongodb.net/superData"
  MONGO_USERNAME = "superuser"
  MONGO_PASSWORD = "SuperPassword"
}

FOR sentive data we need to use Bind credentials to variable step
'''

tools {
nodejs 'Nodejs' 
}
 
 stages{


stage('Installing dependencies') {
            steps {
                
                sh  'npm install --no-audit'
 
                
            }
        }

stage('Dependency scanning') {
            steps {
                
                sh  '''
                  npm audit --audit-level=critical
                   echo $?
               '''
 
                
            }
        }

stage('Unit test') {
            steps {
withCredentials([usernamePassword(credentialsId: 'mongodbcred', passwordVariable: 'MONGO_PASSWORD', usernameVariable: 'MONGO_USERNAME')]) {
    sh  'npm test'
}

}

}


}
